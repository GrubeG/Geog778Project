<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="initial-scale=1,maximum-scale=1,user-scalable=no"
    />
    <title>
      Wisconsin Elections Commission District Map
    </title>

    <link
      rel="stylesheet"
      href="https://js.arcgis.com/4.23/esri/themes/light/main.css"
    />
    <script src="https://js.arcgis.com/4.23/"></script>

    <style>
      html,
      body,
        
      #viewDiv {
        padding: 0;
        margin: 0;
        height: 100%;
        width: 100%;
      }

      #info {
        height: 100%;
        padding: 14px;
        border-radius: 5px;
        width: 120px;
        font-weight: bold;
      }
        
      #infoToolbar {
        padding: 14px;
        border-radius: 5px;
        width: 250px;
        text-align: center;
        
      }
        
      #query-type {
        padding: 8px;
        border-radius: 5px;
        width: 120px;
      }
        
     #pois-filter {
        height: 120px;
        width: 100%;
        visibility: hidden;
      }

      .poi-item {
        width: 125px;
        padding: 13px;
        text-align: center;
        vertical-align: baseline;
        cursor: pointer;
        height: 40px;
        font-size: 13px;
      }

      .poi-item:focus {
        background-color: dimgrey;
      }

      .poi-item:hover {
        background-color: dimgrey;
      }
        
      div.image::before {
        content:url("img/WEC_Logo.png");
      }
      
        
    .esri-editor .esri-item-list__scroller {
        max-height: 100%;
        max-width: 250px;
      }
        
      .esri-view-height-small .esri-expand .esri-widget--panel, .esri-view-height-small .esri-expand .esri-widget--panel-height-only, .esri-view-height-small .esri-ui-corner .esri-component.esri-widget--panel, .esri-view-height-small .esri-ui-corner .esri-component.esri-widget--panel-height-only {
          max-height: 650px;
          min-height: 60%;
          max-width: 250px;
      }
      .esri-ui .esri-editor .esri-item-list__scroller {
          max-height: 100%;
          max-width: 250px;
      }
        
        
    
        
    </style>
    <script>
      require([
        "esri/Map",
        "esri/layers/FeatureLayer",
        "esri/widgets/Editor",
        "esri/widgets/LayerList",
        "esri/views/MapView",
        "esri/popup/content/AttachmentsContent",
        "esri/popup/content/TextContent",
        "esri/widgets/Expand",
        "esri/widgets/Home",
        "esri/widgets/Search",
        "esri/Viewpoint",
        "esri/widgets/Locate",
        "esri/layers/GraphicsLayer",
        "esri/Graphic",
        "esri/symbols/SimpleFillSymbol",
        "esri/symbols/SimpleMarkerSymbol",
        "esri/widgets/BasemapGallery",
        "esri/widgets/Legend",
        "esri/widgets/FeatureTemplates",
        "esri/config",
        "esri/widgets/Print",
        "esri/widgets/Slider",
        
          
        "dojo/on",
        "dojo/dom",
        "dojo/dom-construct",
        "dojo/domReady!"
      ], (
        Map,
        FeatureLayer,
        Editor,
        LayerList,
        MapView,
        AttachmentsContent,
        TextContent,
        Expand,
        Home,
        Search,
        Viewpoint,
        Locate,
        GraphicsLayer,
        Graphic,
        SimpleFillSymbol,
        SimpleMarkerSymbol,
        BasemapGallery,
        Legend,
        FeatureTemplates,
        esriConfig,
        Print,
        Slider,
        on, dom, domConstruct
      ) => {
          
        esriConfig.apiKey = "AAPKd7a5f0028e3d432faec9c8e03740f0d8ntcrv-SGuCaGKZrLrQxv4azO6TaiERQO5QwoBDUznyrB6hxLK2EZe7oCwvq7bldk";
          
        // add the park outline featurelayer
        var layerCongressional = new FeatureLayer({
          url: "https://services.arcgis.com/HRPe58bUyBqyyiCt/arcgis/rest/services/2022_CongressionalDistricts/FeatureServer/0",
          //outFields: ["*"],
          opacity: 0.6,
          title: "Congressional Districts",
          visible: false,
          popupTemplate: {
            // autocasts as new PopupTemplate()
            title: "Congressional District: {CON2021}",
            content: "Active as March, 2022",
            overwriteActions: false
          }
        });
          
        // add the park groves featurelayer
        var layerSenate = new FeatureLayer({
          url: "https://services.arcgis.com/HRPe58bUyBqyyiCt/arcgis/rest/services/2022_Senate_Districts/FeatureServer/0",
          //outFields: ["*"],
          opacity: 0.6,
          title: "State Senate",
          visible: false,
          popupTemplate: {
            // autocasts as new PopupTemplate()
            title: "Senate District: {SEN2021}",
            content: "Active as April 16, 2022",
            overwriteActions: false
          }
        });
        
        // add the park roads featurelayer
        var layerAssembly = new FeatureLayer({
          url: "https://services.arcgis.com/HRPe58bUyBqyyiCt/arcgis/rest/services/2022_Assembly_Districts/FeatureServer/0",
          //outFields: ["*"],
          opacity: 0.6,
          title: "State Assembly",
          visible: false,
          popupTemplate: {
            // autocasts as new PopupTemplate()
            title: "Assembly District: {ASM2021}",
            content: "Active as April 16, 2022",
            overwriteActions: false
          }
        });
          
        // add the park fire history featurelayer
        var layerCountySup = new FeatureLayer({
          url: "https://services.arcgis.com/HRPe58bUyBqyyiCt/arcgis/rest/services/2022_CountySup_Districts/FeatureServer/0",
          //outFields: ["*"],
          opacity: 0.6,
          title: "County Supervisor",
          visible: false,
          popupTemplate: {
            // autocasts as new PopupTemplate()
            title: "County Supervisor",
            content: "County: {CNTY_NAME} </br> Supervisory District: {SUPERID}",
            overwriteActions: false
          },
          labelingInfo: {
              // autocasts as new LabelClass()
              symbol: {
                type: "text", // autocasts as new TextSymbol()
                color: "white",
                haloColor: "black",
                haloSize: 1,
                font: {
                  // autocast as new Font()
                  family: "Merriweather",
                  size: 10,
                  weight: "bold"
                }
              },
              maxScale: 0,
              minScale: 600000,
              //labelPlacement: "above-center",
              labelExpressionInfo: {
                expression: "$feature.SUPERID"
              }
            }
        });
          
        // add the park trails featurelayer
        var layerWards = new FeatureLayer({
          url: "https://services.arcgis.com/HRPe58bUyBqyyiCt/arcgis/rest/services/2022_June_Wards/FeatureServer/0",
          //outFields: ["*"],
          opacity: 0.6,
          title: "Wards",
          visible: false,
          popupTemplate: {
            // autocasts as new PopupTemplate()
            title: "Wards",
            content: "County: {CNTY_NAME} </br> Ward: {LABEL}",
            overwriteActions: false
          },
          minScale: 400000,
          maxScale: 0,
          renderer: {
              type: "simple",  // autocasts as new SimpleRenderer()
              symbol: {
                type: "simple-fill",  // autocasts as new SimpleMarkerSymbol()
                color: null,
                outline: {  // autocasts as new SimpleLineSymbol()
                  width: 1.5,
                  color: "blue"
                }
              }
            },
          labelingInfo: {
              // autocasts as new LabelClass()
              symbol: {
                type: "text", // autocasts as new TextSymbol()
                color: "blue",
                haloColor: "white",
                haloSize: 1,
                font: {
                  // autocast as new Font()
                  family: "Merriweather",
                  size: 8,
                  weight: "bold"
                }
              },
              maxScale: 0,
              minScale: 300000,
              //labelPlacement: "above-center",
              labelExpressionInfo: {
                expression: "$feature.WardLbl"
              }
            }
        });
        
        // add the park trails featurelayer
        var layerDistrictCombos = new FeatureLayer({
          url: "https://services.arcgis.com/HRPe58bUyBqyyiCt/arcgis/rest/services/2022_Redistricting_DCs/FeatureServer/0",
          //outFields: ["*"],
          opacity: 0.6,
          title: "District Combos",
          visible: false,
          popupTemplate: {
            // autocasts as new PopupTemplate()
            title: "District Combo",
            content: "County: {CNTY_NAME} </br> Ward: {LABEL} </br> School: {SDNM} </br> {SanName}",
            overwriteActions: false
          },
          minScale: 400000,
          maxScale: 0,
          renderer: {
              type: "simple",  // autocasts as new SimpleRenderer()
              symbol: {
                type: "simple-fill",  // autocasts as new SimpleMarkerSymbol()
                color: null,
                outline: {  // autocasts as new SimpleLineSymbol()
                  width: 1.25,
                  color: "red"
                }
              }
            },
          labelingInfo: {
              // autocasts as new LabelClass()
              symbol: {
                type: "text", // autocasts as new TextSymbol()
                color: "red",
                haloColor: "white",
                haloSize: 1,
                font: {
                  // autocast as new Font()
                  family: "Merriweather",
                  size: 8,
                  weight: "bold"
                }
              },
              maxScale: 0,
              minScale: 200000,
              //labelPlacement: "above-center",
              labelExpressionInfo: {
                expression: "$feature.WARDID + TextFormatting.NewLine + $feature.SDNM + TextFormatting.NewLine + $feature.SanName"
              }
            }
        });
          
        // add the park trails featurelayer
        var layerSchools = new FeatureLayer({
          url: "https://services.arcgis.com/HRPe58bUyBqyyiCt/arcgis/rest/services/2022_SchoolDistricts/FeatureServer/0",
          //outFields: ["*"],
          opacity: 0.6,
          title: "School Districts",
          visible: false,
          popupTemplate: {
            // autocasts as new PopupTemplate()
            title: "School District",
            content: "District Name: {SDNM} </br> {Union_HS} </br> School District Type: {TYPE}",
            overwriteActions: false
          },
          minScale: 600000,
          maxScale: 0,
          renderer: {
              type: "simple",  // autocasts as new SimpleRenderer()
              symbol: {
                type: "simple-fill",  // autocasts as new SimpleMarkerSymbol()
                color: null,
                outline: {  // autocasts as new SimpleLineSymbol()
                  width: 2,
                  color: "green"
                }
              }
            },
          labelingInfo: {
              // autocasts as new LabelClass()
              symbol: {
                type: "text", // autocasts as new TextSymbol()
                color: "green",
                haloColor: "white",
                haloSize: 1,
                font: {
                  // autocast as new Font()
                  family: "Merriweather",
                  size: 8,
                  weight: "bold"
                }
              },
              maxScale: 0,
              minScale: 400000,
              //labelPlacement: "above-center",
              labelExpressionInfo: {
                expression: "$feature.SDNM + TextFormatting.NewLine + $feature.Union_HS"
              }
            }
        });
          
        // add the park trails featurelayer
        var layerMunis = new FeatureLayer({
          url: "https://services.arcgis.com/HRPe58bUyBqyyiCt/arcgis/rest/services/2022_June_Municipality_CombinedCounty/FeatureServer/0",
          //outFields: ["*"],
          opacity: 0.6,
          title: "Municipalities",
          visible: true,
          minScale: 600000,
          maxScale: 0,
          renderer: {
              type: "simple",  // autocasts as new SimpleRenderer()
              symbol: {
                type: "simple-fill",  // autocasts as new SimpleMarkerSymbol()
                color: null,
                outline: {  // autocasts as new SimpleLineSymbol()
                  width: 2,
                  color: "gray"
                }
              }
            },
          labelingInfo: {
              // autocasts as new LabelClass()
              symbol: {
                type: "text", // autocasts as new TextSymbol()
                color: "gray",
                haloColor: "white",
                haloSize: 1,
                font: {
                  // autocast as new Font()
                  family: "Merriweather",
                  size: 8,
                  weight: "bold"
                }
              },
              maxScale: 0,
              minScale: 300000,
              //labelPlacement: "above-center",
              labelExpressionInfo: {
                expression: "$feature.MuniName"
              },
              //deconflictionStrategy: "none"
            },
            labelsVisible: true,
//          popupTemplate: {
//            // autocasts as new PopupTemplate()
//            title: "Municipality",
//            content: "{MuniType} {MuniName} </br> County: {CNTY_NAME},
//            overwriteActions: false
//          }
        });
          
        // add the park trails featurelayer
        var layerCounties = new FeatureLayer({
          url: "https://services.arcgis.com/HRPe58bUyBqyyiCt/arcgis/rest/services/2022_Counties/FeatureServer/0",
          //outFields: ["*"],
          opacity: 1.0,
          title: "Counties",
          visible: true,
          renderer: {
              type: "simple",  // autocasts as new SimpleRenderer()
              symbol: {
                type: "simple-fill",  // autocasts as new SimpleMarkerSymbol()
                color: null,
                outline: {  // autocasts as new SimpleLineSymbol()
                  width: 2.25,
                  color: "black"
                }
              }
            },
            
            labelingInfo: {
              // autocasts as new LabelClass()
              symbol: {
                type: "text", // autocasts as new TextSymbol()
                color: "black",
                haloColor: "white",
                haloSize: 1,
                font: {
                  // autocast as new Font()
                  family: "Merriweather",
                  size: 8,
                  weight: "bold"
                }
              },
              maxScale: 0,
              minScale: 5000000,
              //labelPlacement: "above-center",
              labelExpressionInfo: {
                expression: "$feature.CNTY_NAME"
              },
              //deconflictionStrategy: "none"
            },
            labelsVisible: true,
//          popupTemplate: {
//            // autocasts as new PopupTemplate()
//            title: "County",
//            content: "County: {CNTY_NAME} </br> Ward: {LABEL} </br> School: {SDNM} </br> {SanName}",
//            overwriteActions: false
//          }
        });
              
        // Create the Map
        const map = new Map({
          basemap: "topo-vector",
          layers: [layerCongressional, layerSenate, layerAssembly, layerCountySup, layerSchools, layerWards, layerDistrictCombos,  layerMunis, layerCounties]
        });
          
        let editor, features, editExpand, filterLayerView, queryLayerView;
          
          
        // *****************************************************
        // add homeButton and expand widgets to UI
        // *****************************************************
        function setupView() {
            
          // set home button view point to initial extent
          var homeButton = new Home({
            view: view
          });
          view.ui.add(homeButton, "top-left");
            
          var locateBtn = new Locate({
            view: view,
            goToOverride: function(view, options) {
                options.target.scale = 1500;
                return view.goTo(options.target);
          }
          });
            
          // Add the locate widget to the top left corner of the view
          view.ui.add(locateBtn, {
            position: "top-left"
          });
            
            
        }

        // *****************************************************
        // Set up the Default MapView
        // *****************************************************
          
        // Create the MapView
        const view = new MapView({
          container: "viewDiv",
          map: map,
          zoom: 7,
          center: [-89.5, 44.60]
        });
          
        setupView();
        
        view.popup.dockOptions = {
              // Disable the dock button so users cannot undock the popup
              position: "bottom-right",
        };
          
        // *****************************************************
        // Create the LayerList widget with the associated actions
        // and add it to the top-right corner of the view.
        // *****************************************************
        
          //Define additional functions section of the layerlist
          function defineActions(event) {
              // The event object contains an item property.
              // is is a ListItem referencing the associated layer
              // and other properties. You can control the visibility of the
              // item, its title, and actions using this object.

              const item = event.item;

              //if (item.title === "Counties") {
                // An array of objects defining actions to place in the LayerList.
                // By making this array two-dimensional, you can separate similar
                // actions into separate groups with a breaking line.

                item.actionsSections = [
                  [
                    {
                      title: "Toggle Labels",
                      className: "esri-icon-labels",
                      id: "labels"
                    },
//                    {
//                      title: "Layer information",
//                      className: "esri-icon-description",
//                      id: "information"
//                    }
                  ],
//                  [
//                    {
//                      title: "Increase opacity",
//                      className: "esri-icon-up",
//                      id: "increase-opacity"
//                    },
//                    {
//                      title: "Decrease opacity",
//                      className: "esri-icon-down",
//                      id: "decrease-opacity"
//                    }
//                  ]
                ];
              //}
          
          
              // Adds a slider for updating a group layer's opacity
              //if (item.children.length > 1 && item.parent) {
                const slider = new Slider({
                  min: 0,
                  max: 1,
                  precision: 2,
                  //steps: 0.2,
                  values: [1],
                  snapOnClickEnabled: true,
                  visibleElements: {
                    labels: true,
                    rangeLabels: true
                  }
                });

                item.panel = {
                  content: [
                      slider,
                      
                  ],
                  className: "esri-icon-sliders-horizontal",
                  title: "Change Layer Opacity"
                };

                slider.on("thumb-drag", (event) => {
                  const { value } = event;
                  item.layer.opacity = value;
                });
              //}
          }
          
          // LayerList
          layerList = new LayerList({
              container: document.createElement("div"),
              view: view,
              listItemCreatedFunction: defineActions
            });
          
          // Event listener that fires each time an action is triggered

          layerList.on("trigger-action", (event) => {
            // The layer visible in the view at the time of the trigger.
            //const visibleLayer = layerCounties.visible;

            // Capture the action id.
            const id = event.action.id;

            
                
            //toggle labels for each layer on and off
            if (id === "labels") {
              if (event.item.layer.labelsVisible  === false) {
                event.item.layer.labelsVisible = true;
                console.log(event.item.layer.labelsVisible);
              } else {
                event.item.layer.labelsVisible = false;
                console.log(event.item.layer.labelsVisible);
              }
            }
              
              
//             else if (id === "information") {
//              // if the information action is triggered, then
//              // open the item details page of the service layer
//              window.open(visibleLayer.url);
//            } 
          });
          
            
          let layerListExpand = new Expand({
              expandIconClass: "esri-icon-layers",
              expandTooltip: "Expand Districts List",
              view: view,
              expanded: false,
              content: layerList.container,
              mode: "floating",
              group: "top-right"
            });
          
          //add instruction information when user expands the widget
          layerListExpand.watch("expanded", () => {
            if (layerListExpand.expanded) {
              var fieldNameText = document.getElementById('info');
              fieldNameText.textContent = "Click the layer name or eye icon to turn that layer on/off.";
            }
            //clear the filters when user closes the expand widget  
            if (!layerListExpand.expanded) {
              var fieldNameText = document.getElementById('info');
              fieldNameText.textContent = "Select a tool on the right to use that specific function.";
            }
          });

          
        
          
        // *****************************************************
        // Create tooltip widget with the associated actions
        // and add it to the top-right corner of the view.
        // ***************************************************** 
        
        //add text information
        let tooltip = document.getElementById("info")
          
        
        let tooltipExpand = new Expand({
              expandIconClass: "esri-icon-comment",
              expandTooltip: "Expand Tooltip",
              view: view,
              expanded: true,
              content: tooltip,
              mode: "floating",
              group: "top-left"
            });
          
        //add text information
          view.ui.add(tooltipExpand, {
            position: "top-left",
            //index: 1
            });
          
        // *****************************************************
        // Create print widget with the associated actions
        // and add it to the top-right corner of the view.
        // ***************************************************** 
        
        //add print information
        let printMap = new Print({
            view: view,  // The view that provides access to the map's "streets-vector" basemap
            // specify your own print service
            printServiceUrl:
                "https://utility.arcgisonline.com/arcgis/rest/services/Utilities/PrintingTools/GPServer/Export%20Web%20Map%20Task"
        });
          
        
        let printExpand = new Expand({
              expandIconClass: "esri-icon-printer",
              expandTooltip: "Expand Print/Export",
              view: view,
              expanded: false,
              content: printMap ,
              mode: "floating",
              group: "top-left"
            });
          
        //add text information
          view.ui.add(printExpand, {
            position: "top-left",
            //index: 1
            });
          
        // *****************************************************
        // Create the Basemap widget with the associated actions
        // and add it to the top-right corner of the view.
        // *****************************************************
        
//        let basemapGallery = new BasemapGallery({
//          view: view,  // The view that provides access to the map's "streets-vector" basemap
//          expandIconClass: "esri-icon-basemap"  // Allows for toggling to the "hybrid" basemap
//        });
          
        let basemapExpand = new Expand({
              expandIconClass: "esri-icon-basemap",
              expandTooltip: "Expand Basemap Gallery",
              view: view,
              expanded: false,
              content: new BasemapGallery({ view }),
              mode: "floating",
              group: "top-left"
            });
          
        // Add widget to the top right corner of the view
        view.ui.add(basemapExpand, "top-left");
        
        // *****************************************************
        // Create and intro message widget with the associated actions
        // and add it to the top-right corner of the view.
        // ***************************************************** 
        
        //add text information
        let infoToolbar = document.getElementById("infoToolbar")
          
        
        let infoToolbarExpand = new Expand({
              expandIconClass: "esri-icon-description",
              expandTooltip: "Expand Information Panel",
              view: view,
              expanded: true,
              content: infoToolbar,
              mode: "floating",
              group: "top-right"
            });
          

          
         
        
        // *****************************************************
        // Create the legend widget with the associated actions
        // and add it to the top-right corner of the view.
        // ***************************************************** 
          
        let legend = new Legend({
            view: view,
        });
        
        let legendExpand = new Expand({
              expandIconClass: "esri-icon-legend",
              expandTooltip: "Expand Legend",
              view: view,
              expanded: false,
              content: legend,
              mode: "floating",
              group: "top-right"
            });
          
          //add instruction information when user expands the widget
          legendExpand.watch("expanded", () => {
            if (legendExpand.expanded) {
              var fieldNameText = document.getElementById('info');
              fieldNameText.textContent = "View symbology of all currently active layers";
            }
            //clear the filters when user closes the expand widget  
            if (!legendExpand.expanded) {
              var fieldNameText = document.getElementById('info');
              fieldNameText.textContent = "Select a tool on the right to use that specific function.";
            }
          });
        
          
        // *****************************************************
        // Create the Search widget with the associated actions
        // and add it to the top-right corner of the view.
        // *****************************************************
          
        var searchWidget = new Search({
          view: view,
          allPlaceholder: "Enter Location",
          includeDefaultSources: false,
          sources: [
            {
              layer: layerCounties,
              searchFields: ["CNTY_NAME"],
              displayField: "CNTY_NAME",
              //suggestionTemplate: "{Name}, Party: {Party}",
              exactMatch: false,
              outFields: ["CNTY_NAME"],
              placeholder: "Example: ADAMS",
              name: "County",

            },
            {
              layer: layerMunis,
              searchFields: ["MuniName"],
              displayField: "Label",
              exactMatch: false,
              //outFields: ["POINAME", "POITYPE"],
              name: "Municipality",
              //zoomScale: 10000,
              placeholder: "Example: Madison"

            },
            
            {
              layer: layerSchools,
              searchFields: ["SDNM"],
              displayField: "SDNM",
              //suggestionTemplate: "{Name}, Party: {Party}",
              exactMatch: false,
              outFields: ["SDNM"],
              placeholder: "Example: D C Everest",
              name: "School District",

            },
          ]
        });
          
        //expand widget
          let searchExpand = new Expand({
            expandIconClass: "esri-icon-search",
            expandTooltip: "Expand Search",
            expanded: false,
            view: view,
            mode: "floating",
            content: searchWidget,
            group: "top-right"
          });
          
          //add instruction information when user expands the widget
          searchExpand.watch("expanded", () => {
            if (searchExpand.expanded) {
              var fieldNameText = document.getElementById('info');
              fieldNameText.textContent = "Click down arrow to select item type. To search, begin to type the first few letters of the feature and select from the list.";
            }
            //clear the filters when user closes the expand widget  
            if (!searchExpand.expanded) {
              var fieldNameText = document.getElementById('info');
              fieldNameText.textContent = "Select a tool on the right to use that specific function.";
            }
          });

          
//        // *****************************************************
//        // Create the Query widget with the associated actions
//        // and add it to the top-right corner of the view.
//        // *****************************************************
//        
//        
//
//        // additional query fields initially set to null for basic query
//        let distance = 0.5;
//        let units = "miles";
//
//        //create graphic for mouse point click
//        const pointGraphic = new Graphic({
//          symbol: {
//            type: "simple-marker", // autocasts as new SimpleMarkerSymbol()
//            color: [0, 0, 139],
//            outline: {
//              color: [255, 255, 255],
//              width: 1.5
//            }
//          }
//        });
//
//        // Create graphic for distance buffer
//        const bufferGraphic = new Graphic({
//          symbol: {
//            type: "simple-fill", // autocasts as new SimpleFillSymbol()
//            color: [173, 216, 230, 0.2],
//            outline: {
//              // autocasts as new SimpleLineSymbol()
//              color: [255, 255, 255],
//              width: 1
//            }
//          }
//        });
//
//        // when query type changes, set appropriate values
//        var queryOpts = document.getElementById("query-type");
//
//        queryOpts.addEventListener("change", () => {
//          switch (queryOpts.value) {
//            // values set for distance query
//            case "OneMile":
//              distance = 1;
//              units = "miles";
//              break;
//            case "TwoMiles":
//              distance = 2;
//              units = "miles";
//              break;
//            case "FiveMiles":
//              distance = 5;
//              units = "miles";
//              break;
//            default:
//              // Default set to basic query
//              distance = 0.5;
//              units = "miles";
//          }
//        });
//        
//
//        function queryFeatures(screenPoint) {
//          const point = view.toMap(screenPoint);
//          layerCounties.queryFeatures({
//              geometry: point,
//              // distance and units will be null if basic query selected
//              distance: distance,
//              units: units,
//              spatialRelationship: "intersects",
//              returnGeometry: false,
//              returnQueryGeometry: true,
//              outFields: ["*"]
//            })
//            .then((featureSet) => {
//              // set graphic location to mouse pointer and add to mapview
////              pointGraphic.geometry = point;
////              view.graphics.add(pointGraphic);
//              
//              // open popup of query result
//              view.popup.open({
//                location: point,
//                features: featureSet.features,
//                featureMenuOpen: true
//              });
//              view.popup.dockOptions = {
//                  // Change position of the default docking
//                  position: "bottom-right",
//                };
//              // The popup will automatically be dockEnabled when made visible
//              view.popup.dockEnabled = true;
//              
//              if (featureSet.queryGeometry) {
//                bufferGraphic.geometry = featureSet.queryGeometry;
//                view.graphics.add(bufferGraphic);
//                view.goTo(bufferGraphic);
//              }
//            });
//        }
//          
//        let queryExpand = new Expand({
//            view: view,
//            content: queryOpts,
//            mode: "floating",
//            expandTooltip: "Expand Query",
//            expandIconClass: "esri-icon-review",
//            group: "top-right"
//          });
//          //start query tool when user clicks expand button
//          
//          queryExpand.watch("expanded", () => {
//            if (queryExpand.expanded) {
//                mouseEvtHandler = view.on("click", (event) => {
//                    view.graphics.remove(pointGraphic);
//                    if (view.graphics.includes(bufferGraphic)) {
//                        view.graphics.remove(bufferGraphic);
//                    }
//                    
//                    queryFeatures(event);
//                });
//                var fieldNameText = document.getElementById('info');
//                fieldNameText.textContent = "Select a buffer distance and click a location on the map to return the Points of Interest within that distance.";
//            }
//            //clear the query when user closes the expand widget
//            if (!queryExpand.expanded) {
//                mouseEvtHandler.remove();
//                mouseEvtHandler = null;
//                view.graphics.remove(pointGraphic);
//                    if (view.graphics.includes(bufferGraphic)) {
//                        view.graphics.remove(bufferGraphic);
//                    }
//                var fieldNameText = document.getElementById('info');
//                fieldNameText.textContent = "Select a tool on the right to use that specific function.";
//            }
//          }); 
          
        // *****************************************************
        // Create the Filter widget with the associated actions
        // and add it to the top-right corner of the view.
        // *****************************************************
          
        const poisNodes = document.querySelectorAll(`.poi-item`);
        const poisElement = document.getElementById("poi-filter");

        // click event handler for pois choices
        poisElement.addEventListener("click", filterBypoi);

        // set an attribute filter on filter layer view
        // to display the warnings issued in that poi
        function filterBypoi(event) {
          const selectedpoi = event.target.getAttribute("data-poi");
          filterLayerView.filter = {
            where: "POITYPE = '" + selectedpoi + "'"
          };
        }

        view.whenLayerView(layerCounties).then((layerView) => {
          // flash filter warnings layer loaded
          // get a reference to the filter warnings layerview
          filterLayerView = layerView;

          // set up UI items
          poisElement.style.visibility = "visible";
        
          let poisExpand = new Expand({
            view: view,
            content: poisElement,
            mode: "floating",
            expandTooltip: "Expand Filter",
            expandIconClass: "esri-icon-filter",
            group: "top-right"
          });
            
          //add instruction information when user expands the widget
          poisExpand.watch("expanded", () => {
            if (poisExpand.expanded) {
              var fieldNameText = document.getElementById('info');
              fieldNameText.textContent = "Filter view of data layers. Closing the Filter tool will reset to default.";
            }
            //clear the filters when user closes the expand widget  
            if (!poisExpand.expanded) {
              filterLayerView.filter = null;
              var fieldNameText = document.getElementById('info');
              fieldNameText.textContent = "Select a tool on the right to use that specific function.";
            }
          });
          //view.ui.add(poisExpand, "top-right");
          view.ui.add([infoToolbarExpand, editExpand, legendExpand, searchExpand, poisExpand, layerListExpand], "top-right");
            
        });
          
        
      });
    </script>
  </head>

  <body>
    <body class="sassy-theme">
        <div id="viewDiv"></div>
    <div id="info" class="esri-widget">   
      Select a tool on the right to use that specific function.
    </div>
    <div id="infoToolbar" class="esri-widget">
        <div class="image"></div>
        <h3>Wisconsin Voting Districts</h3>
        Every 10 years, as a result of the U.S. Census, Wisconsin has to complete the redistricting process. When ballots are created for each election, the races are determined by different districts.
        <br><br>
        To get started, click on the specific district information that you want to see by clicking the Expand District List button. For local districts, search first for the county or municipality to zoom directly to that location. To view district, click on the eye icon. For those districts that are grayed out, zoom to appropriate level to be able to see them.
        
        
        <br>
        <h6>Created by Greg Grube for Geography 778 at UW-Madison, Summer 2022.</h6>

    </div>
    <div id="poi-filter" class="esri-widget">
      <div class="poi-item visible-poi" data-poi="Current County">Current County</div>
      <div class="poi-item visible-poi" data-poi="Current Municipality">Current Muni</div>
    </div>
<!--
    <div id="optionsDiv" class="esri-widget">
      <select id="query-type" class="esri-widget">
        <option value="distance">1/2 Mile</option>
        <option value="OneMile">One Mile</option>
        <option value="TwoMiles">Two Miles</option>
        <option value="FiveMiles">Five Miles</option>
        
      </select>  
        
    </div>
-->
  </body>
</html>