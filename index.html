<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="initial-scale=1,maximum-scale=1,user-scalable=no"
    />
    <title>
      Wisconsin Elections Commission District Map
    </title>

    <link
      rel="stylesheet"
      href="https://js.arcgis.com/4.23/esri/themes/light/main.css"
    />
    <script src="https://js.arcgis.com/4.23/"></script>

    <style>
      html,
      body,
        
      #viewDiv {
        padding: 0;
        margin: 0;
        height: 100%;
        width: 100%;
      }

      #info {
        height: 100%;
        padding: 14px;
        border-radius: 5px;
        width: 120px;
        font-weight: bold;
      }
        
      #infoToolbar {
        padding: 14px;
        border-radius: 5px;
        width: 250px;
        text-align: center;
        
      }
        
      #query-type {
        padding: 8px;
        border-radius: 5px;
        width: 120px;
      }
        
     #pois-filter {
        height: 120px;
        width: 100%;
        visibility: hidden;
      }

      .poi-item {
        width: 125px;
        padding: 13px;
        text-align: center;
        vertical-align: baseline;
        cursor: pointer;
        height: 40px;
        font-size: 13px;
      }

      .poi-item:focus {
        background-color: dimgrey;
      }

      .poi-item:hover {
        background-color: dimgrey;
      }
        
      div.image::before {
        content:url("img/SEKI_logo.PNG");
      }
      
        
    .esri-editor .esri-item-list__scroller {
        max-height: 100%;
        max-width: 250px;
      }
        
      .esri-view-height-small .esri-expand .esri-widget--panel, .esri-view-height-small .esri-expand .esri-widget--panel-height-only, .esri-view-height-small .esri-ui-corner .esri-component.esri-widget--panel, .esri-view-height-small .esri-ui-corner .esri-component.esri-widget--panel-height-only {
          max-height: 650px;
          min-height: 60%;
          max-width: 250px;
      }
      .esri-ui .esri-editor .esri-item-list__scroller {
          max-height: 100%;
          max-width: 250px;
      }    
        
    </style>
    <script>
      require([
        "esri/Map",
        "esri/layers/FeatureLayer",
        "esri/widgets/Editor",
        "esri/widgets/LayerList",
        "esri/views/MapView",
        "esri/popup/content/AttachmentsContent",
        "esri/popup/content/TextContent",
        "esri/widgets/Expand",
        "esri/widgets/Home",
        "esri/widgets/Search",
        "esri/Viewpoint",
        "esri/widgets/Locate",
        "esri/layers/GraphicsLayer",
        "esri/Graphic",
        "esri/symbols/SimpleFillSymbol",
        "esri/symbols/SimpleMarkerSymbol",
        "esri/widgets/BasemapToggle",
        "esri/widgets/Legend",
        "esri/widgets/FeatureTemplates",
        "esri/config",
        
          
        "dojo/on",
        "dojo/dom",
        "dojo/dom-construct",
        "dojo/domReady!"
      ], (
        Map,
        FeatureLayer,
        Editor,
        LayerList,
        MapView,
        AttachmentsContent,
        TextContent,
        Expand,
        Home,
        Search,
        Viewpoint,
        Locate,
        GraphicsLayer,
        Graphic,
        SimpleFillSymbol,
        SimpleMarkerSymbol,
        BasemapToggle,
        Legend,
        FeatureTemplates,
        esriConfig,
        on, dom, domConstruct
      ) => {
          
        esriConfig.apiKey = "AAPKd7a5f0028e3d432faec9c8e03740f0d8ntcrv-SGuCaGKZrLrQxv4azO6TaiERQO5QwoBDUznyrB6hxLK2EZe7oCwvq7bldk";
          
        // add the park outline featurelayer
        var layerCongressional = new FeatureLayer({
          url: "https://services.arcgis.com/HRPe58bUyBqyyiCt/arcgis/rest/services/2022_CongressionalDistricts/FeatureServer/0",
          //outFields: ["*"],
          opacity: 0.3,
          title: "Congressional Districts",
          visible: false,
          popupTemplate: {
            // autocasts as new PopupTemplate()
            title: "Congressional District: {CON2021}",
            content: "Active as March, 2022",
            overwriteActions: false
          }
        });
          
        // add the park groves featurelayer
        var layerSenate = new FeatureLayer({
          url: "https://services.arcgis.com/HRPe58bUyBqyyiCt/arcgis/rest/services/2022_Senate_Districts/FeatureServer/0",
          //outFields: ["*"],
          opacity: 0.5,
          title: "State Senate",
          visible: false,
          popupTemplate: {
            // autocasts as new PopupTemplate()
            title: "Senate District: {SEN2021}",
            content: "Active as April 16, 2022",
            overwriteActions: false
          }
        });
        
        // add the park roads featurelayer
        var layerAssembly = new FeatureLayer({
          url: "https://services.arcgis.com/HRPe58bUyBqyyiCt/arcgis/rest/services/2022_Assembly_Districts/FeatureServer/0",
          //outFields: ["*"],
          opacity: 0.8,
          title: "State Assembly",
          visible: false,
          popupTemplate: {
            // autocasts as new PopupTemplate()
            title: "Assembly District: {ASM2021}",
            content: "Active as April 16, 2022",
            overwriteActions: false
          }
        });
        
        // add the park trails featurelayer
        var layerDistrictCombos = new FeatureLayer({
          url: "https://services.arcgis.com/HRPe58bUyBqyyiCt/arcgis/rest/services/2022_Redistricting_DCs/FeatureServer/0",
          //outFields: ["*"],
          opacity: 0.8,
          title: "District Combos",
          visible: true,
          popupTemplate: {
            // autocasts as new PopupTemplate()
            title: "District Combo",
            content: "Ward: {LABEL} </br> School: {SDNM} </br> {SanName}",
            overwriteActions: false
          }
        });
          
        // View how each marker
        // symbol is created for Points of Interest
        const layerPOIRenderer = {
          type: "unique-value",
          field: "POITYPE",
          uniqueValueInfos: [
            {
              value: "Restroom",
              symbol: {
                type: "picture-marker",
                url: "img/restrooms-black-22.svg",
                contentType: "image/svg",  
              }   
            },
            {
              value: "Trailhead",
              symbol: {
                type: "picture-marker",
                url: "img/trailhead-black-22.svg",
                contentType: "image/svg",
              }
            },
            {
              value: "Ranger Station",
              symbol: {
                type: "picture-marker",
                url: "img/ranger-station-black-22.svg",
                contentType: "image/svg",
              }
            },
            {
              value: "Campground",
              symbol: {
                type: "picture-marker",
                url: "img/campground-black-22.svg",
                contentType: "image/svg",
              }
            },
            {
              value: "Telephone",
              symbol: {
                type: "picture-marker",
                url: "img/telephone-black-22.svg",
                contentType: "image/svg",
              }
            },
            {
              value: "Picnic Area",
              symbol: {
                type: "picture-marker",
                url: "img/picnic-area-black-22.svg",
                contentType: "image/svg",
              }
            },
            {
              value: "Store",
              symbol: {
                type: "picture-marker",
                url: "img/snack-bar-black-22.svg",
                contentType: "image/svg",
              }
            },
            {
              value: "Lodge",
              symbol: {
                type: "picture-marker",
                url: "img/sleeping-shelter-black-22.svg",
                contentType: "image/svg",
              }
            },
            {
              value: "Entrance Station",
              symbol: {
                type: "picture-marker",
                url: "img/entrance-station-black-22.svg",
                contentType: "image/svg",
              }
            },
            {
              value: "Visitor Center",
              symbol: {
                type: "picture-marker",
                url: "img/visitor-center-black-22.svg",
                contentType: "image/svg",
              }
            },
          ]
        };
        
        // add the park points of interest featurelayer
        var layerPOI = new FeatureLayer({
          url: "https://services.arcgis.com/HRPe58bUyBqyyiCt/arcgis/rest/services/seki_poi/FeatureServer/0",
          outFields: ["POITYPE"],
          title: "Points of Interest",
          visible: true,
          renderer: layerPOIRenderer,
          popupTemplate: {
            // autocasts as new PopupTemplate()
            title: "Feature: {POINAME}",
            content: "Feature Type: {POITYPE}",
            overwriteActions: false
          }
        });
        
        // add the park fire history featurelayer
        var layerFireHistory = new FeatureLayer({
          url: "https://services.arcgis.com/HRPe58bUyBqyyiCt/arcgis/rest/services/seki_fhst/FeatureServer/0",
          //outFields: ["*"],
          opacity: 0.8,
          title: "Fire History",
          visible: false,
        });
          
        // Create the Map
        const map = new Map({
          basemap: "topo-vector",
          layers: [layerCongressional, layerFireHistory, layerSenate, layerDistrictCombos, layerAssembly, layerPOI]
        });
          
        let editor, features, editExpand, filterLayerView, queryLayerView;
          
          
        // *****************************************************
        // add homeButton and expand widgets to UI
        // *****************************************************
        function setupView() {
            
          // set home button view point to initial extent
          var homeButton = new Home({
            view: view
          });
          view.ui.add(homeButton, "top-left");
            
          var locateBtn = new Locate({
            view: view,
            goToOverride: function(view, options) {
                options.target.scale = 1500;
                return view.goTo(options.target);
          }
          });
            
          // Add the locate widget to the top left corner of the view
          view.ui.add(locateBtn, {
            position: "top-left"
          });
            
            
        }
        // *****************************************************
        // Creates actions in the LayerList
        // *****************************************************

        function defineActions(event) {
          // The event object contains an item property.
          // is is a ListItem referencing the associated layer
          // and other properties. You can control the visibility of the
          // item, its title, and actions using this object.

          const item = event.item;

          if (item.title === "SEKI Layers") {
            // An array of objects defining actions to place in the LayerList.
            // By making this array two-dimensional, you can separate similar
            // actions into separate groups with a breaking line.

            item.actionsSections = [
              [
                {
                  title: "Go to full extent",
                  className: "esri-icon-zoom-out-fixed",
                  id: "full-extent"
                },
                {
                  title: "Layer information",
                  className: "esri-icon-description",
                  id: "information"
                }
              ],
//              [
//                {
//                  title: "Increase opacity",
//                  className: "esri-icon-up",
//                  id: "increase-opacity"
//                },
//                {
//                  title: "Decrease opacity",
//                  className: "esri-icon-down",
//                  id: "decrease-opacity"
//                }
//              ]
            ];
          }
        }
        
          
        /*************************************************************
         * The PopupTemplate content is the text that appears inside the
         * popup. Bracketed {fieldName} can be used to reference the value
         * of an attribute of the selected feature. HTML elements can be
         * used to provide structure and styles within the content.
         **************************************************************/
        const editThisAction = {
          title: "Edit feature",
          id: "edit-this",
          className: "esri-icon-edit"
        };

        // Create a popupTemplate for the featurelayer and pass in a function to set its content and specify an action to handle editing the selected feature
        const template = {
          title: "User Name: {UserName}",
          content: OverallConLevel,
          fieldInfos: [
            {
              fieldName: "UserName"
            },
            {
              fieldName: "OverallCon"
            }
          ],
          //actions: [editThisAction]
        };

        // Function that creates two popup elements for the template: attachments and text
        function OverallConLevel(feature) {
          // 1. Set how the attachments should display within the popup
          const attachmentsElement = new AttachmentsContent({
            displayType: "list"
          });

          const textElement = new TextContent();

          
        }
        // View how each marker
        // symbol is created for Points of Interest
        const layerTreesRenderer = {
          type: "unique-value",
          field: "OverallCon",
          uniqueValueInfos: [
            {
              value: "Excellent",
              symbol: {
                type: "picture-marker",
                url: "img/sequoia-excellent.svg",
                contentType: "image/svg",  
              }   
            },
            {
              value: "Good",
              symbol: {
                type: "picture-marker",
                url: "img/sequoia-good.svg",
                contentType: "image/svg",
              }
            },
            {
              value: "Average",
              symbol: {
                type: "picture-marker",
                url: "img/sequoia-average.svg",
                contentType: "image/svg",
              }
            },
            {
              value: "Poor",
              symbol: {
                type: "picture-marker",
                url: "img/sequoia-poor.svg",
                contentType: "image/svg",
              }
            },
            {
              value: "Fallen",
              symbol: {
                type: "picture-marker",
                url: "img/sequoia-fallen.svg",
                contentType: "image/svg",
              }
            },
            
          ]
        };

        var layerTrees = new FeatureLayer({
          url: "https://services.arcgis.com/HRPe58bUyBqyyiCt/arcgis/rest/services/seki_trees/FeatureServer/0",
          outFields: ["*"],
          title: "Sequoia Trees",
          visible: true,
          renderer: layerTreesRenderer,
          popupTemplate: {
            // autocasts as new PopupTemplate()
            title: "Tree Condition - {OverallCon}",
            content: "</br>Grove: {GroveName} </br>Tree Diameter: {TreeDiam} </br>Surface Fuel Level: {SurFuel} </br>Burn Damage: {BurnDamage} </br>Collector Name: {UserName} </br>Collector Role: {UserType}",
            overwriteActions: false
          }
          //popupTemplate: template
        });
        map.add(layerTrees);

        // Create the MapView
        const view = new MapView({
          container: "viewDiv",
          map: map,
          zoom: 7,
          center: [-89.5, 44.60]
        });
          
        setupView();
        
        view.popup.dockOptions = {
              // Disable the dock button so users cannot undock the popup
              position: "bottom-right",
        };
          
        // *****************************************************
        // Create the LayerList widget with the associated actions
        // and add it to the top-right corner of the view.
        // *****************************************************
        
          // LayerList
          layerList = new LayerList({
              container: document.createElement("div"),
              view: view
            });
            
          let layerListExpand = new Expand({
              expandIconClass: "esri-icon-layers",
              expandTooltip: "Expand Layer List",
              view: view,
              expanded: false,
              content: layerList,
              mode: "floating",
              group: "top-right"
            });
          
          //add instruction information when user expands the widget
          layerListExpand.watch("expanded", () => {
            if (layerListExpand.expanded) {
              var fieldNameText = document.getElementById('info');
              fieldNameText.textContent = "Click the layer name or eye icon to turn that layer on/off.";
            }
            //clear the filters when user closes the expand widget  
            if (!layerListExpand.expanded) {
              var fieldNameText = document.getElementById('info');
              fieldNameText.textContent = "Select a tool on the right to use that specific function.";
            }
          });

          
        // *****************************************************
        // Create the Basemap Toggle widget with the associated actions
        // and add it to the top-right corner of the view.
        // *****************************************************
        
        let basemapToggle = new BasemapToggle({
          view: view,  // The view that provides access to the map's "streets-vector" basemap
          nextBasemap: "hybrid"  // Allows for toggling to the "hybrid" basemap
        });
          
        // Add widget to the top right corner of the view
        view.ui.add(basemapToggle, "bottom-left");
          
        // *****************************************************
        // Create tooltip widget with the associated actions
        // and add it to the top-right corner of the view.
        // ***************************************************** 
        
        //add text information
        let tooltip = document.getElementById("info")
          
        
        let tooltipExpand = new Expand({
              expandIconClass: "esri-icon-comment",
              expandTooltip: "Expand Tooltip",
              view: view,
              expanded: true,
              content: tooltip,
              mode: "floating",
              group: "top-left"
            });
          
        //add text information
          view.ui.add(tooltipExpand, {
            position: "top-left",
            //index: 1
            });
        
        // *****************************************************
        // Create and intro message widget with the associated actions
        // and add it to the top-right corner of the view.
        // ***************************************************** 
        
        //add text information
        let infoToolbar = document.getElementById("infoToolbar")
          
        
        let infoToolbarExpand = new Expand({
              expandIconClass: "esri-icon-description",
              expandTooltip: "Expand Information Panel",
              view: view,
              expanded: true,
              content: infoToolbar,
              mode: "floating",
              group: "top-right"
            });
          

          
         
        
        // *****************************************************
        // Create the legend widget with the associated actions
        // and add it to the top-right corner of the view.
        // ***************************************************** 
          
        let legend = new Legend({
            view: view,
        });
        
        let legendExpand = new Expand({
              expandIconClass: "esri-icon-legend",
              expandTooltip: "Expand Legend",
              view: view,
              expanded: false,
              content: legend,
              mode: "floating",
              group: "top-right"
            });
          
          //add instruction information when user expands the widget
          legendExpand.watch("expanded", () => {
            if (legendExpand.expanded) {
              var fieldNameText = document.getElementById('info');
              fieldNameText.textContent = "View symbology of all currently active layers";
            }
            //clear the filters when user closes the expand widget  
            if (!legendExpand.expanded) {
              var fieldNameText = document.getElementById('info');
              fieldNameText.textContent = "Select a tool on the right to use that specific function.";
            }
          });
        
          
        // *****************************************************
        // Create the Search widget with the associated actions
        // and add it to the top-right corner of the view.
        // *****************************************************
          
        var searchWidget = new Search({
          view: view,
          allPlaceholder: "Enter Location",
          includeDefaultSources: false,
          sources: [
            {
              layer: layerCongressional,
              searchFields: ["CON2021"],
              displayField: "CON2021",
              exactMatch: false,
              //outFields: ["POINAME", "POITYPE"],
              name: "Congressional",
              //zoomScale: 10000,
              placeholder: "Example: 8"

            },
            {
              layer: layerSenate,
              searchFields: ["SEN2021"],
              displayField: "SEN2021",
              //suggestionTemplate: "{Grove_Name}",
              exactMatch: false,
              //outFields: ["Grove_Name"],
              resultGraphicEnabled: false,
              placeholder: "Example: 22",
              name: "Senate",

            },
            {
              layer: layerDistrictCombos,
              searchFields: ["LABEL"],
              displayField: "LABEL",
              //suggestionTemplate: "{Name}, Party: {Party}",
              exactMatch: false,
              outFields: ["LABEL", "SDNM"],
              placeholder: "Example: ADAMS",
              name: "District Combos",

            },
          ]
        });
          
        //expand widget
          let searchExpand = new Expand({
            expandIconClass: "esri-icon-search",
            expandTooltip: "Expand Search",
            expanded: false,
            view: view,
            mode: "floating",
            content: searchWidget,
            group: "top-right"
          });
          
          //add instruction information when user expands the widget
          searchExpand.watch("expanded", () => {
            if (searchExpand.expanded) {
              var fieldNameText = document.getElementById('info');
              fieldNameText.textContent = "Click down arrow to select item type. To search, begin to type the first few letters of the feature and select from the list.";
            }
            //clear the filters when user closes the expand widget  
            if (!searchExpand.expanded) {
              var fieldNameText = document.getElementById('info');
              fieldNameText.textContent = "Select a tool on the right to use that specific function.";
            }
          });

      
          
        // *****************************************************
        // Create the Editor widget with the associated actions
        // and add it to the top-right corner of the view.
        // *****************************************************

        view.when(() => {
          // Create the Editor with the specified layer and a list of field configurations
          var editor = new Editor({
            view: view,
            container: document.createElement("div"),
            supportingWidgetDefaults: {
              featureTemplates: {
                visibleElements: {
                    filter: false, // disable the default filter UI
                }
              }
            },
                
            layerInfos: [
              {
                layer: layerTrees,
                
                formTemplate: {
                  // autocasts to FormTemplate
                  elements: [
                    // autocasts to FieldElement
                    {
                      type: "field",
                      fieldName: "UserName",
                      label: "User Name",
                      editable: true,
                      hint: "Enter your name"
                    },
                    {
                      type: "field",
                      fieldName: "UserType",
                      label: "User Type",
                      hint: "Select user role"
                    },
                    {
                      type: "field",
                      fieldName: "GroveName",
                      label: "Grove Name",
                      hint: "Select grove location"
                    },
                    {
                      type: "field",
                      fieldName: "TreeDiam",
                      label: "Tree Diameter",
                      hint: "Select trunk thickness"
                    },
                    {
                      type: "field",
                      fieldName: "SurFuel",
                      label: "Surface Fuel",
                      hint: "Select fuel buildup level"
                    },
                    {
                      type: "field",
                      fieldName: "BurnDamage",
                      label: "Burn Damage",
                      hint: "Select tree burn damage"
                    },
                    {
                      type: "field",
                      fieldName: "OverallCon",
                      label: "Overall Condition",
                      hint: "Select overall condition"
                    },
                    
                  ]
                }
              }
            ]
          });
            
        //expand widget
          editExpand = new Expand({
            expandIconClass: "esri-icon-edit",
            expandTooltip: "Expand Tree Editor",
            expanded: false,
            view: view,
            content: editor,
            mode: "floating",
            group: "top-right"
          });
        
        //add instruction information when user expands the widget
          editExpand.watch("expanded", () => {
            if (editExpand.expanded) {
              var fieldNameText = document.getElementById('info');
              fieldNameText.textContent = "Under Sequoia Trees, select the condition level and place a new tree location on map. Select Edit features option and click on existing point to change attribute information.";
            }
            //clear the filters when user closes the expand widget  
            if (!editExpand.expanded) {
              var fieldNameText = document.getElementById('info');
              fieldNameText.textContent = "Select a tool on the right to use that specific function.";
            }
          });
            
          
            
        });
          
        // *****************************************************
        // Create the Query widget with the associated actions
        // and add it to the top-right corner of the view.
        // *****************************************************
        
        

        // additional query fields initially set to null for basic query
        let distance = 0.5;
        let units = "miles";

        //create graphic for mouse point click
        const pointGraphic = new Graphic({
          symbol: {
            type: "simple-marker", // autocasts as new SimpleMarkerSymbol()
            color: [0, 0, 139],
            outline: {
              color: [255, 255, 255],
              width: 1.5
            }
          }
        });

        // Create graphic for distance buffer
        const bufferGraphic = new Graphic({
          symbol: {
            type: "simple-fill", // autocasts as new SimpleFillSymbol()
            color: [173, 216, 230, 0.2],
            outline: {
              // autocasts as new SimpleLineSymbol()
              color: [255, 255, 255],
              width: 1
            }
          }
        });

        // when query type changes, set appropriate values
        var queryOpts = document.getElementById("query-type");

        queryOpts.addEventListener("change", () => {
          switch (queryOpts.value) {
            // values set for distance query
            case "OneMile":
              distance = 1;
              units = "miles";
              break;
            case "TwoMiles":
              distance = 2;
              units = "miles";
              break;
            case "FiveMiles":
              distance = 5;
              units = "miles";
              break;
            default:
              // Default set to basic query
              distance = 0.5;
              units = "miles";
          }
        });
        

        function queryFeatures(screenPoint) {
          const point = view.toMap(screenPoint);
          layerPOI.queryFeatures({
              geometry: point,
              // distance and units will be null if basic query selected
              distance: distance,
              units: units,
              spatialRelationship: "intersects",
              returnGeometry: false,
              returnQueryGeometry: true,
              outFields: ["*"]
            })
            .then((featureSet) => {
              // set graphic location to mouse pointer and add to mapview
//              pointGraphic.geometry = point;
//              view.graphics.add(pointGraphic);
              
              // open popup of query result
              view.popup.open({
                location: point,
                features: featureSet.features,
                featureMenuOpen: true
              });
              view.popup.dockOptions = {
                  // Change position of the default docking
                  position: "bottom-right",
                };
              // The popup will automatically be dockEnabled when made visible
              view.popup.dockEnabled = true;
              
              if (featureSet.queryGeometry) {
                bufferGraphic.geometry = featureSet.queryGeometry;
                view.graphics.add(bufferGraphic);
                view.goTo(bufferGraphic);
              }
            });
        }
          
        let queryExpand = new Expand({
            view: view,
            content: queryOpts,
            mode: "floating",
            expandTooltip: "Expand Query",
            expandIconClass: "esri-icon-review",
            group: "top-right"
          });
          //start query tool when user clicks expand button
          
          queryExpand.watch("expanded", () => {
            if (queryExpand.expanded) {
                mouseEvtHandler = view.on("click", (event) => {
                    view.graphics.remove(pointGraphic);
                    if (view.graphics.includes(bufferGraphic)) {
                        view.graphics.remove(bufferGraphic);
                    }
                    
                    queryFeatures(event);
                });
                var fieldNameText = document.getElementById('info');
                fieldNameText.textContent = "Select a buffer distance and click a location on the map to return the Points of Interest within that distance.";
            }
            //clear the query when user closes the expand widget
            if (!queryExpand.expanded) {
                mouseEvtHandler.remove();
                mouseEvtHandler = null;
                view.graphics.remove(pointGraphic);
                    if (view.graphics.includes(bufferGraphic)) {
                        view.graphics.remove(bufferGraphic);
                    }
                var fieldNameText = document.getElementById('info');
                fieldNameText.textContent = "Select a tool on the right to use that specific function.";
            }
          }); 
          
        // *****************************************************
        // Create the Filter widget with the associated actions
        // and add it to the top-right corner of the view.
        // *****************************************************
          
        const poisNodes = document.querySelectorAll(`.poi-item`);
        const poisElement = document.getElementById("poi-filter");

        // click event handler for pois choices
        poisElement.addEventListener("click", filterBypoi);

        // set an attribute filter on filter layer view
        // to display the warnings issued in that poi
        function filterBypoi(event) {
          const selectedpoi = event.target.getAttribute("data-poi");
          filterLayerView.filter = {
            where: "POITYPE = '" + selectedpoi + "'"
          };
        }

        view.whenLayerView(layerPOI).then((layerView) => {
          // flash filter warnings layer loaded
          // get a reference to the filter warnings layerview
          filterLayerView = layerView;

          // set up UI items
          poisElement.style.visibility = "visible";
        
          let poisExpand = new Expand({
            view: view,
            content: poisElement,
            mode: "floating",
            expandTooltip: "Expand Filter",
            expandIconClass: "esri-icon-filter",
            group: "top-right"
          });
            
          //add instruction information when user expands the widget
          poisExpand.watch("expanded", () => {
            if (poisExpand.expanded) {
              var fieldNameText = document.getElementById('info');
              fieldNameText.textContent = "Filter Point of Interest type by selecting from the list. Closing the Filter tool will reset to default.";
            }
            //clear the filters when user closes the expand widget  
            if (!poisExpand.expanded) {
              filterLayerView.filter = null;
              var fieldNameText = document.getElementById('info');
              fieldNameText.textContent = "Select a tool on the right to use that specific function.";
            }
          });
          //view.ui.add(poisExpand, "top-right");
          view.ui.add([infoToolbarExpand, editExpand, legendExpand, searchExpand, poisExpand, queryExpand, layerListExpand], "top-right");
            
        });
          
        
        
        
          
          
        
      });
    </script>
  </head>

  <body>
    <body class="sassy-theme">
        <div id="viewDiv"></div>
    <div id="info" class="esri-widget">   
      Select a tool on the right to use that specific function.
    </div>
    <div id="infoToolbar" class="esri-widget">
        <div class="image"></div>
        <h3>Wisconsin Voting Districts</h3>
        The Giant Sequoia is the most massive type of tree in the world. While it is well adapted to natural fire conditions, because of changing climate conditions and fire supression methods, the Sequoia are at much greater risk of destructive fires today, including those in the summer of 2021. As a result, the park has decided to task both its own staff and volunteers to inventory the Giant Sequoias within the known groves in the park.
        <br><br>
        To use this application, click on the tools to the right of the map. The primary tool is an editor tool to add a new tree entry or edit existing information. There is also a filter for Points of Interest and a query tool to find Points of Interest near the user's location. Finally, there are tools for searching for locations, turning on/off data layers and for viewing a legend.
        <br>
        <h6>Data and symbology courtesy National Park Service. Created by Greg Grube for Geography 777 at UW-Madison, Spring 2022.</h6>

    </div>
    <div id="poi-filter" class="esri-widget">
      <div class="poi-item visible-poi" data-poi="Restroom">Restroom</div>
      <div class="poi-item visible-poi" data-poi="Ranger Station">Ranger Station</div>
      <div class="poi-item visible-poi" data-poi="Trailhead">Trailhead</div>
      <div class="poi-item visible-poi" data-poi="Campground">Campground</div>
      <div class="poi-item visible-poi" data-poi="Telephone">Telephone</div>
      <div class="poi-item visible-poi" data-poi="Picnic Area">Picnic Area</div>
      <div class="poi-item visible-poi" data-poi="Store">Store</div>
      <div class="poi-item visible-poi" data-poi="Lodge">Lodge</div>
      <div class="poi-item visible-poi" data-poi="Entrance Station">Entrance Station</div>
      <div class="poi-item visible-poi" data-poi="Visitor Center">Visitor Center</div>
    </div>
    <div id="optionsDiv" class="esri-widget">
      <select id="query-type" class="esri-widget">
        <option value="distance">1/2 Mile</option>
        <option value="OneMile">One Mile</option>
        <option value="TwoMiles">Two Miles</option>
        <option value="FiveMiles">Five Miles</option>
        
      </select>
        
        
    </div>
  </body>
</html>